# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  MASTER PIPELINE ORCHESTRATOR                                  â•‘
# â•‘  Coordinates all tribe system pipelines in parallel            â•‘
# â•‘  Triggers: push (any branch), PR to main/develop              â•‘
# â•‘                                                                â•‘
# â•‘  Pipeline Flow:                                                â•‘
# â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
# â•‘  â”‚ BayaniHub   â”‚  â”‚ DAMAYAN     â”‚  â”‚ HopeCard    â”‚  PARALLEL  â•‘
# â•‘  â”‚ Web Pipelineâ”‚  â”‚ Web Pipelineâ”‚  â”‚ Web Pipelineâ”‚            â•‘
# â•‘  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â•‘
# â•‘         â”‚                â”‚                â”‚                    â•‘
# â•‘         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â•‘
# â•‘                          â–¼                                     â•‘
# â•‘              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â•‘
# â•‘              â”‚   Deploy to Staging   â”‚  (main/develop only)    â•‘
# â•‘              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â•‘
# â•‘                          â–¼                                     â•‘
# â•‘              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â•‘
# â•‘              â”‚   Production Gate     â”‚  (tagged releases)      â•‘
# â•‘              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
name: "Master Pipeline Orchestrator"

on:
  push:
    branches: ["**"]
  pull_request:
    branches: [main, develop]

permissions:
  contents: read
  packages: write
  pull-requests: write

concurrency:
  group: master-pipeline-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  # â•‘  STAGE 1 â€” All Frontend Pipelines (PARALLEL)               â•‘
  # â•‘  Tests + Lint + Security + SonarCloud + Build               â•‘
  # â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  bayanihub-web:
    name: "BayaniHub-Web Pipeline"
    uses: ./.github/workflows/front-end-workflow.yml
    with:
      system-dir: BayaniHub-Web
      system-name: BayaniHub-Web
    secrets: inherit

  damayan-web:
    name: "DAMAYAN-Web Pipeline"
    uses: ./.github/workflows/front-end-workflow.yml
    with:
      system-dir: DAMAYAN-Web
      system-name: DAMAYAN-Web
    secrets: inherit

  hopecard-web:
    name: "HopeCard-Web Pipeline"
    uses: ./.github/workflows/front-end-workflow.yml
    with:
      system-dir: HopeCard-Web
      system-name: HopeCard-Web
    secrets: inherit

  # â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  # â•‘  STAGE 2 â€” Deploy to Staging (main/develop only, PARALLEL) â•‘
  # â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  deploy-staging-bayanihub:
    name: "Staging â€” BayaniHub-Web"
    needs: [bayanihub-web]
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop'
    uses: ./.github/workflows/deploy-staging.yml
    with:
      system-dir: BayaniHub-Web
      system-name: BayaniHub-Web
      app-type: web
      artifact-name: BayaniHub-Web-web-build
    secrets: inherit

  deploy-staging-damayan:
    name: "Staging â€” DAMAYAN-Web"
    needs: [damayan-web]
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop'
    uses: ./.github/workflows/deploy-staging.yml
    with:
      system-dir: DAMAYAN-Web
      system-name: DAMAYAN-Web
      app-type: web
      artifact-name: DAMAYAN-Web-web-build
    secrets: inherit

  deploy-staging-hopecard:
    name: "Staging â€” HopeCard-Web"
    needs: [hopecard-web]
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop'
    uses: ./.github/workflows/deploy-staging.yml
    with:
      system-dir: HopeCard-Web
      system-name: HopeCard-Web
      app-type: web
      artifact-name: HopeCard-Web-web-build
    secrets: inherit

  # â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  # â•‘  STAGE 3 â€” Production Gate (main branch only)              â•‘
  # â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  production-gate:
    name: "Production Readiness Gate"
    needs: [deploy-staging-bayanihub, deploy-staging-damayan, deploy-staging-hopecard]
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    uses: ./.github/workflows/production-gate.yml
    with:
      system-dir: Tribe3-Frontend
      app-type: web
    secrets: inherit

  # â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  # â•‘  STAGE 4 â€” Pipeline Summary & Notifications                â•‘
  # â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  pipeline-summary:
    name: "Pipeline Summary"
    needs: [bayanihub-web, damayan-web, hopecard-web]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Pipeline Results
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘          MASTER PIPELINE SUMMARY                     â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘ Repository: ${{ github.repository }}"
          echo "â•‘ Branch:     ${{ github.ref_name }}"
          echo "â•‘ Commit:     ${{ github.sha }}"
          echo "â•‘ Actor:      ${{ github.actor }}"
          echo "â•‘ Timestamp:  $(date -u +%Y-%m-%dT%H:%M:%SZ)"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘ BayaniHub-Web:   ${{ needs.bayanihub-web.result }}"
          echo "â•‘ DAMAYAN-Web:     ${{ needs.damayan-web.result }}"
          echo "â•‘ HopeCard-Web:    ${{ needs.hopecard-web.result }}"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          FAILED=false
          if [[ "${{ needs.bayanihub-web.result }}" == "failure" ]]; then FAILED=true; fi
          if [[ "${{ needs.damayan-web.result }}" == "failure" ]]; then FAILED=true; fi
          if [[ "${{ needs.hopecard-web.result }}" == "failure" ]]; then FAILED=true; fi

          if [ "$FAILED" = "true" ]; then
            echo "âŒ One or more pipelines failed!"
            exit 1
          fi
          echo "âœ… All pipelines completed successfully!"

      - name: Notify on Failure
        if: failure()
        run: |
          echo "ğŸ”” Pipeline failure notification"
          echo "Failed pipelines detected for commit ${{ github.sha }}"
          echo "Author: ${{ github.actor }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          # Add Slack/Discord/Email notification here
          # curl -X POST "$SLACK_WEBHOOK" -d '{"text": "Pipeline failed..."}'

